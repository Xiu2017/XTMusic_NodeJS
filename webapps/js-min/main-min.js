var keyword="华晨宇";var limit=20;var offset=1;var type="netease";var endOffset=false;var ended=false;var nownum=0;var time=0;var timing;var isShow=true;var flashSpeed=500;$(function(){$("#search_button").click(function(){search()});$("#time_off").click(function(event){$("#selectmode").css("display","none");var selecttime=$("#selecttime")[0];switch(selecttime.style.display){case"none":selecttime.style.display="block";break;case"block":selecttime.style.display="none";break;default:selecttime.style.display="block";break}event.stopPropagation()});$(".cleartime").click(function(){cleartime()});$(".open").click(function(){showLrc()});$("#last").click(function(){play_last()});$("#play").click(function(){play_pause()});$("#next").click(function(){play_next()});$("#pro_bar").click(function(){bar_val()});$("#playmode").click(function(event){setPlayMode(0);event.stopPropagation()});$("#search").focus(function(){$(this).attr("placeholder","")});$("#search").blur(function(){$(this).attr("placeholder","歌名/歌手/专辑")});$('#search').bind('keypress',function(event){if(event.keyCode=="13"){$('#search_button').click()}});$("#select").change(function(){$('#search_button').click();changeTheme(type)});document.onclick=function(){$("#selecttime,#selectmode").css("display","none")};document.onkeydown=function(event){var e=event||window.event||arguments.callee.caller.arguments[0];if($("#search")[0]==document.activeElement)return;if(e&&e.keyCode==32){play_pause();e.preventDefault()}};$(window).bind('beforeunload',function(){return'确定关闭炫听音乐吗？'});$("#center_right").mouseover(function(){openlrc(true);if(!isShow){window.frames["audiolrc"].showdelrc(true)}else{window.frames["audiolrc"].showdelrc(false)}});$("#center_right").mouseout(function(){openlrc(false);window.frames["audiolrc"].showdelrc(false)});changeTheme(type)});function search(isNextPage){let audiolist=window.frames["audiolist"];let searchVal=$("#search").val();let selected=$("#select option:selected").val();if(!isNextPage){offset=1;audiolist.table.songs=null;if(keyword!=searchVal||type!=selected){audiolist.num=0;audiolist.lastli=-1;audiolist.$("td").removeAttr("style").removeAttr("value")}}type=selected;keyword=searchVal;if(keyword==""){keyword="华晨宇"}endOffset=true;let url=urlEncode('getMusicList?keyword='+keyword+'&limit='+limit+'&offset='+offset+'&type='+type);$.ajax({url:url,success:function(result){if(result!="-1"){let table=audiolist.table;let songs=table.songs;let res=JSON.parse(result).songs;if(!songs){table.songs=res}else{table.songs=songs.concat(res)}if(res.length>=limit){endOffset=false}}}});if(!isShow){showLrc()}}function nextPage(){offset++;search(true)}function play_pause(){let audiolist=window.frames["audiolist"];let playButton=$("#play");let audio=audiolist.$("#audio")[0];let vinyl=$("#vinyl");let vinylHeader=$("#vinylheader");if(!audio.src){audiolist.changeSrc(1,0);return}if(audio.paused){audio.play();audiolist.playgif(true);vinyl.css("animation-play-state","running");vinylHeader.css("animation","vinyldown 300ms forwards");playButton.html("&#xe82f;");playButton.css({"padding-left":"0px","width":"44px"});$("#pro_time").css("display","block");clearInterval("play_time()");setInterval("play_time()",500)}else{audio.pause();audiolist.playgif(false);vinyl.css("animation-play-state","paused");vinylHeader.css("animation","vinylup 300ms forwards");playButton.html("&#xe831;");playButton.css({"padding-left":"2px","width":"42px"});clearInterval("play_time()")}}function play_last(){let audiolist=window.frames["audiolist"];nownum=audiolist.lastli;audiolist.changeSrc(audiolist.mode,nownum-1)}function play_next(){let audiolist=window.frames["audiolist"];nownum=audiolist.lastli;audiolist.changeSrc(audiolist.mode,nownum+1)}function play_time(){let audiolist=window.frames["audiolist"];let audio=audiolist.$("#audio")[0];let minc=Math.floor(Math.round(audio.currentTime)/60);if(minc<10)minc="0"+minc;let secc=Math.round(audio.currentTime)%60;if(secc<10)secc="0"+secc;let mind=Math.floor(Math.round(audio.duration)/60);if(isNaN(mind))mind="00";else if(mind<10)mind="0"+mind;let secd=Math.round(audio.duration)%60;if(isNaN(secd))secd="00";else if(secd<10)secd="0"+secd;$("#song_time").text(minc+":"+secc+"/"+mind+":"+secd);let marginleft=668/audio.duration;$("#pro_time").css("margin-left",Math.round(marginleft*audio.currentTime*100)/100+"px");$("#pro_bar").css("background-size",Math.round(marginleft*audio.currentTime*100)/100+5+"px 4px");if(audio.ended&&!ended&&audiolist.mode==2){ended=true;audiolist.changeSrc(2,audiolist.num)}else if(audio.ended&&!ended){ended=true;play_next()}}function bar_val(){let audio=window.frames["audiolist"].$("#audio")[0];if(audio.duration){$("#pro_time").css("margin-left",event.offsetX-2+"px");$("#pro_bar").css("background-size",event.offsetX-2+"px");audio.currentTime=(audio.duration/668)*event.offsetX}window.frames["audiolrc"].playlrc(1)}function closeDown(){let audio=window.frames["audiolist"].$("#audio")[0];if(!audio.paused){play_pause()}}function setTimeOff(timemin){var st=$(".showtime");let ct=$(".cleartime");time=timemin*60;clearInterval(timing);st.text(convertTime(time--));st.css({"color":"#FFF","display":"inline"});ct.css("display","inline");$("#selecttime").css("display","none");timing=setInterval(function(){if(time<0){clearInterval(timing);closeDown()}else{st.text(convertTime(time));time--}},1000)}function cleartime(){clearInterval(timing);$(".showtime").css("display","none");$(".cleartime").css("display","none")}function setPlayMode(mode){let audiolist=window.frames["audiolist"];let playMode=$("#playmode");let selMode=$("#selectmode");let state=selMode.css("display");$("#selecttime").css("display","none");switch(mode){case 0:if(state=="none")selMode.css("display","block");else if(state=="block")selMode.css("display","none");else selMode.css("display","block");break;case 1:selMode.css("display","none");playMode.html("&#xe83f");audiolist.mode=1;break;case 2:selMode.css("display","none");playMode.html("&#xe840");audiolist.mode=2;break;case 3:selMode.css("display","none");playMode.html("&#xe83e");audiolist.mode=3;break}}function showLrc(){let audiolrc=window.frames["audiolrc"];let centerLeft=$('#center_left');let centerRight=$('#center_right');let vinyl=$('#vinyl');let vinylImg=$('#vinylimg');let vinylHeader=$('#vinylheader');let openButton=$('.open');let lrcIframe=$('#center_right iframe');let lrcContents=$('#audiolrc').contents();if(isShow){centerLeft.animate({'width':'0px'},flashSpeed);centerRight.animate({'width':'999px'},flashSpeed);vinylHeader.animate({'width':'120px','height':'180px','marginLeft':'-510px','marginTop':'-404px'},flashSpeed);vinyl.animate({'marginLeft':'-690px','marginTop':'80px','width':'300px','height':'300px'},flashSpeed);vinylImg.animate({'borderRadius':'102px','width':'204px','height':'204px','marginTop':'48px'},flashSpeed);openButton.animate({'marginTop':'230px'},flashSpeed);openButton.html('&#xf105;');lrcIframe.animate({'width':'500px','height':'410px','marginTop':'36px','marginRight':'-180px'},flashSpeed);lrcContents.find('body').animate({'width':'500px','marginLeft':'-20px'},flashSpeed);lrcContents.find('ul').animate({'margin':'260px 0px 260px 0px'},flashSpeed);lrcContents.find('#nolrc').animate({'marginTop':'60px','fontSize':'32px'},flashSpeed);audiolrc.maxsize=20;isShow=false}else{centerLeft.animate({'width':'767px'},flashSpeed);centerRight.animate({'width':'232px'},flashSpeed);vinylHeader.animate({'width':'54px','height':'86px','marginLeft':'150px','marginTop':'-190px'},flashSpeed);vinyl.animate({'width':'160px','height':'160px','marginLeft':'35px','marginTop':'20px'},flashSpeed);vinylImg.animate({'borderRadius':'54px','width':'108px','height':'108px','marginTop':'26px'},flashSpeed);openButton.animate({'marginTop':'-250px'},flashSpeed);openButton.html('&#xf104;');lrcIframe.animate({'width':'230px','height':'260px','marginTop':'-30px','marginRight':'0px'},flashSpeed);lrcContents.find('body').animate({'width':'189px','marginLeft':'0px'},flashSpeed);lrcContents.find('ul').animate({'margin':'145px 0px'},flashSpeed);lrcContents.find('#nolrc').animate({'marginTop':'0px','fontSize':'18px'},flashSpeed);audiolrc.maxsize=14;isShow=true;audiolrc.playlrc(1)}if(audiolrc.songlrc){audiolrc.liarray[0]=parseInt(lrcContents.find("ul li:eq(0)").get(0).offsetHeight);for(var i=1;i<=audiolrc.lrctime.length-1;i++){audiolrc.liarray[i]=audiolrc.liarray[i-1]+parseInt(lrcContents.find("ul li:eq("+i+")").get(0).offsetHeight)}}if(!isShow)audiolrc.playlrc(1)}function openlrc(num){let openButton=$(".open");if(num){openButton.css("display","block")}else{openButton.css("display","none")}}function urlEncode(url){url=encodeURIComponent(url);url=url.replace(/\%3A/g,":");url=url.replace(/\%2F/g,"/");url=url.replace(/\%3F/g,"?");url=url.replace(/\%3D/g,"=");url=url.replace(/\%26/g,"&");return url}function convertTime(time){let hou=Math.floor(time/3600);if(hou==0)hou="";else if(hou<10)hou="0"+hou+":";else if(hou>=10)hou=hou+":";let min=Math.floor(time/60-Math.floor(time/3600)*60);if(min<10)min="0"+min;let sec=Math.round(time)%60;if(sec<10)sec="0"+sec;return hou+""+min+":"+sec}